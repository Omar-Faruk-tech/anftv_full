<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ANF-tv Official website">
  <link rel="icon" type="image/png" href="https://anf-tv.netlify.app/public/images/tv logo 2.png"/>
  <meta name="keywords" content="news,anf,tv,politics,sports,business,culture,africa,nigeria,entertainment,science,technology">
  <title>ANF-tv</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
  <link rel="stylesheet" href="../stylesheets/header.css">
  <link rel="stylesheet" href="../stylesheets/category-main.css">
  <link rel="stylesheet" href="../stylesheets/footer.css">
</head>
<body>
  <div class="modal" id="modal-background" onclick="closeNav()">
    <div>
      <i id="close" onclick="closeNav()" class="fas fa-times"></i>
    </div>
      <div class="news-categories-mobile">
        <ul id="news-list-container-mobile" class="news-cat-container">
          <li id="news-mobile">
            <a href="../index.html" class="nav-a-link" id="news-link">News</a>
          </li>
          <li id="politics-mobile">
            <a href="./category.html" class="nav-a-link" id="politics-link">Politics</a>
          </li>
          <li id="sports-mobile">
            <a href="./category.html" class="nav-a-link" id="sports-link">Sports</a>
          </li>
          <li id="culture-mobile">
            <a href="./category.html" class="nav-a-link" id="culture-link">Culture</a>
          </li>
          <li id="business-mobile">
            <a href="./category.html" class="nav-a-link" id="business-link">Business</a>
          </li>
          <li id="entertainment-mobile">
            <a href="./category.html" class="nav-a-link" id="entertainment-link">Entertainment</a>
          </li>
          <li id="science-technology-mobile">
            <a href="./category.html" class="nav-a-link" id="science-technology-link">Technology</a>
          </li>
        </ul>
      </div>
    </div>
    <header id="header">
      <nav id="navbar">
        <div id="logo">
          <img src="https://anf-tv.netlify.app/public/images/Untitled-2.png" alt="ANF-tv">
        </div>
        <div id="news-categories">
          <ul id="news-list-container" class="news-cat-container">
            <li id="news">
              <a href="../index.html" class="nav-a-link" id="news-link">News</a>
            </li>
            <li id="politics">
              <a href="./category.html" id="politics-link" class="nav-a-link">Politics</a>
            </li>
            <li id="sports">
              <a href="./category.html" id="sports-link" class="nav-a-link">Sports</a>
            </li>
            <li id="culture">
              <a href="./category.html" id="culture-link" class="nav-a-link">Culture</a>
            </li>
            <li id="business">
              <a href="./category.html" id="business-link" class="nav-a-link">Business</a>
            </li>
            <li id="entertainment">
              <a href="./category.html" id="entertainment-link" class="nav-a-link">Entertainment</a>
            </li>
            <li id="science-technology">
              <a href="./category.html" id="science-technology-link" class="nav-a-link">Technology</a>
            </li>
          </ul>
        </div>
        <div id="search">
          <input type="search" name="search" placeholder="Search" id="search-input">
          <button id="search-button">
            <img id="search-img" src="https://anf-tv.netlify.app/public/images/Search.png" alt="search-icon" id="search-icon">
          </button>
        </div>
        <div id="hamburger" onclick="openNav()">
          <i class="fas fa-bars"></i>
        </div>
      </nav>
      <hr id="nav-border">
    </header>
  <main id="category-main">
    <div id="main-container">
      <section id="image-and-caption">
        <summary class="summary">
     
        </summary>
        <summary class="summary">

        </summary>
        <summary class="summary">

        </summary>
        <summary class="summary">
 
        </summary>
        <summary class="summary">

        </summary>
        <summary class="summary">
 
        </summary>
        <summary class="summary">
    
        </summary>
        <summary class="summary">
  
        </summary>
        <summary class="summary">

        </summary>
        <summary class="summary">

        </summary>
      </section>
    </div>
    <div id="pagination">
      <a href="" id="first-pagi" class="pagi-button">
          &lt; &lt;
      </a>
      <a href="" id="previous-pagi" class="pagi-button">
          &lt;
      </a>
      <a href="" id="current-pagi" class="pagi-button">
        1
      </a>
      <a href="" id="next-pagi" class="pagi-button">
        &gt;
      </a>
      <a href="" id="last-pagi" class="pagi-button">
        &gt; &gt;
      </a>
    </div>
  </main>
  <footer id="footer">
    <div id="anf-tv-ads">
      <img class="footer-ads-img" src="https://anf-tv.netlify.app/public/images/Untitled-2.png" alt="" id="ad-img">
    </div>
    <div id="footer-nav">
      <div id="left-p">
        <p id="company" class="company">
          <a class="footer-p-link" href="">Company </a>
        </p>
      </div>
      <div id="center-icon">
        <img src="https://anf-tv.netlify.app/public/images/Untitled-2.png" alt="Company Icon" id="company-icon" class="company-icon">
      </div>
      <div id="right-p">
        <p id="helpdesk" class="helpdesk">
          <a class="footer-p-link" href=""> Help desk </a>
        </p>
      </div>
    </div>
    <hr style="border: #2201f9 solid 0.5px;">
    <div id="footer-contact">
      <a href="https://web.facebook.com/watch/ANFTV.NET/" target="_blank">
      <i class="fab fa-facebook"></i>
      </a>
      <a href="" target="_blank">
      <i class="fab fa-twitter"></i>
      </a>
      <a href="" target="_blank">
      <i class="fab fa-instagram"></i>
      </a>
      <a href="https://www.youtube.com/channel/UCsGp2q5PC4i9zuOgx850fbQ" target="_blank">
        <i class="fab fa-youtube"></i>
      </a>
    </div>
    <p id="footer-copy-right">
      Â© ANF-tv, Inc. 2022. Thank you for visiting.
    </p>
  </footer>
  <script src="../javascripts/index.js"></script>
  <script src="../javascripts/category.js"></script>
  <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>

  <script type="text/javascript">

function setCookie(cname, cvalue, exdays) {
  const d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  let expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
  // alert('done');
}

    function getCookie(cname) {
      let name = cname + "=";
      let decodedCookie = decodeURIComponent(document.cookie);
      let ca = decodedCookie.split(';');
      for(let i = 0; i <ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }
    // var captions = document.getElementsByClassName("caption");

    var summaryContainer = document.getElementsByClassName("summary");

    function shortenStr(str, num = 200) {
      let newStr = '';
      let shortStr = str.split("").splice(0, num).join("");
      if (str.length > num) {
        newStr = `${shortStr}...`
        return newStr;
      }
      newStr = `${str}.....`
      return newStr
    };

    function storeId(data, container) {
      let span = document.createElement('span');
      span.style.display = "none"
      span.innerHTML = data.id;
      container.appendChild(span);
    };
    
    

    $(function() {
  $(document).ready(function() {
      let category = getCookie("category").toLowerCase();
      console.log(category);
      console.log(captions[0]);
      console.log(summaryContainer[0]);


      $.ajax({
        type: "GET",
        url: `/news/${category}/1`,


        success: function (response) {
        console.log('success');
        console.log(response);
        // add modal class on success 
        for (let i = 0; i < response.length; i++) {
          storeId(response[i], summaryContainer[i]);
          let media = document.createElement("iframe");
          let caption  = document.createElement("p");
          caption.classList.add('caption');
          summaryContainer[i].appendChild(caption);
          caption.innerHTML = shortenStr(response[i].subject, 90);
          media.src = response[i].media;
          media.classList.add('summary-media');
          summaryContainer[i].appendChild(media);
        }
      },
        error: function(xhr, status, error) {
          console.log(xhr);
        let resError = xhr.statusText
       console.log('error');
       console.log(resError);
        $("#response").html(resError);
        // Optionally alert the user of an error here...
        }
  });


});
});


$('.summary, .summary-media, .caption').on("click", function() {
      let span = $(this).children()[0].innerHTML;
      // console.log(span);
      $.ajax({
        type: "GET",
        url: `/news/${span}`,
        success: function(response) {
          // console.log(response.category);
          sessionStorage.setItem('clickedNews', JSON.stringify(response));
          window.location = "./single-view.html"
        },
        error: function(xhr, status, error) {
          // console.log(xhr)
        }
      })

    })
  </script>
</body>
</html>